# 提案: 评估商品搜索技术选型

## 变更ID
`evaluate-search-technology`

## Why

项目技术栈中包含了 Elasticsearch（已在 pom.xml 中引入依赖，但实际代码中未使用），而当前商品搜索功能是通过 MySQL 的 `LIKE` 模糊查询实现的。这导致：

1. **技术债务**: 未使用的 ES 依赖增加了项目的复杂度和维护成本
2. **文档误导**: README 中标注"Elasticsearch（待完善）"给用户造成困惑
3. **配置冗余**: docker-compose.yml 中包含未使用的 ES 服务配置

需要评估并确定最合适的搜索技术方案，以提高项目质量和可维护性。

## What Changes

本提案评估并优化商品搜索技术选型，包括：

1. **移除未使用的 Elasticsearch 依赖**
   - 从 pom.xml 中移除 spring-boot-starter-data-elasticsearch
   - 从 docker-compose.yml 中移除 Elasticsearch 服务配置
   - 更新项目文档说明

2. **优化 MySQL 搜索性能**
   - 添加 FULLTEXT 全文索引支持
   - 实现 Redis 缓存机制（5分钟过期）
   - 支持两种搜索方式：全文索引搜索和 LIKE 模糊搜索

3. **更新技术文档**
   - README.md: 更新技术栈说明和性能优化描述
   - CLAUDE.md: 更新搜索功能说明
   - tasks.md: 记录实施细节

## 问题陈述

项目技术栈中包含了 Elasticsearch（已在 pom.xml 中引入依赖，但实际代码中未使用），而当前商品搜索功能是通过 MySQL 的 `LIKE` 模糊查询实现的。需要评估：

1. 当前项目的规模和搜索需求
2. MySQL 模糊查询是否足够
3. 是否有必要引入 Elasticsearch
4. 两种方案的优劣对比

## 背景分析

### 当前实现方式

通过查看 `ProductMapper.xml:36-40`，当前商品搜索使用 MySQL 的 `LIKE` 模糊查询：

```sql
AND (p.name LIKE CONCAT('%', #{keyword}, '%')
     OR p.subtitle LIKE CONCAT('%', #{keyword}, '%')
     OR p.description LIKE CONCAT('%', #{keyword}, '%'))
```

### 项目实际情况

1. **项目性质**: 课程实训项目（两人小组，前后端分离）
2. **项目规模**: B2C 电子商城系统
3. **技术栈复杂度**: 已使用 Spring Boot、MySQL、Redis、Spring Security、JWT 等
4. **README 说明**: "搜索引擎：Elasticsearch（待完善）"
5. **代码状态**: 虽然 pom.xml 中引入了 Elasticsearch 依赖，但实际代码中没有任何 Elasticsearch 相关实现

### 搜索需求分析

从功能模块来看，项目需要的搜索功能：

1. **商品关键词搜索** - 按商品名称、副标题、描述搜索
2. **分类筛选** - 按分类筛选商品
3. **热门商品** - 按销量排序
4. **新品推荐** - 按创建时间排序
5. **相关商品** - 同分类下的其他商品

这些都是基础的查询场景，不涉及复杂的高级搜索需求。

## 技术方案对比

### 方案 A: 保留 MySQL 模糊查询（推荐）

**优势:**
- **简单直接**: 对于课程实训项目规模，MySQL 完全足够
- **降低复杂度**: 减少技术栈复杂度，避免引入过多技术
- **易于维护**: 减少一个依赖服务的维护成本
- **性能可接受**: 对于课程实训的中小规模数据，性能完全满足需求
- **部署简单**: 无需额外部署和配置 Elasticsearch 服务
- **学习成本低**: 团队成员更熟悉 MySQL

**劣势:**
- 性能相对较低（但在课程实训规模下不明显）
- 缺乏高级搜索功能（分词、同义词、拼音搜索等）
- 大数据量下性能会下降

**适用场景:**
- 课程实训项目
- 商品数量 < 10,000
- 并发查询 < 100 QPS
- 无复杂搜索需求

### 方案 B: 引入 Elasticsearch

**优势:**
- **强大的全文搜索**: 支持中文分词、同义词、模糊匹配
- **高性能**: 倒排索引，搜索速度快
- **高可扩展性**: 支持分布式部署
- **丰富功能**: 高亮显示、搜索建议、聚合统计等

**劣势:**
- **增加复杂度**: 需要维护额外的 ES 服务
- **资源消耗**: 内存和 CPU 占用较高
- **学习成本**: 需要学习 ES 的查询语法和配置
- **过度设计**: 对于课程实训项目来说可能过度
- **数据同步**: 需要维护 MySQL 与 ES 的数据同步

**适用场景:**
- 生产环境项目
- 商品数量 > 50,000
- 并发查询 > 500 QPS
- 需要复杂搜索功能

## 性能评估

### MySQL LIKE 查询性能

对于中小规模数据：

| 商品数量 | 查询响应时间 | 评价 |
|---------|-------------|------|
| 1,000   | < 50ms      | 优秀 |
| 10,000  | 50-200ms    | 良好 |
| 50,000  | 200-1000ms  | 一般 |
| 100,000 | > 1000ms    | 较差 |

**优化建议:**
- 为搜索字段添加全文索引
- 使用 `FULLTEXT` 索引代替 `LIKE`
- 添加 Redis 缓存热门搜索结果

### Elasticsearch 性能

对于各种规模数据：

| 商品数量 | 查询响应时间 | 评价 |
|---------|-------------|------|
| 1,000   | < 20ms      | 优秀 |
| 10,000  | < 30ms      | 优秀 |
| 50,000  | < 50ms      | 优秀 |
| 100,000 | < 100ms     | 优秀 |

## 建议

**推荐方案 A（保留 MySQL 模糊查询）**

### 理由

1. **项目性质**: 这是一个课程实训项目，不是生产环境
2. **实际需求**: 搜索功能简单，无需 ES 的高级特性
3. **复杂度控制**: 项目已使用多种技术，应避免过度设计
4. **当前状态**: ES 依赖已引入但未实现，说明实际需求不强
5. **README 标记**: 标记为"待完善"的非核心功能

### 优化措施

如果 MySQL 性能不够，可以先尝试以下优化：

1. **添加索引**:
   ```sql
   ALTER TABLE product ADD FULLTEXT INDEX ft_name_subtitle (name, subtitle);
   ```

2. **使用全文搜索**:
   ```sql
   WHERE MATCH(p.name, p.subtitle) AGAINST(#{keyword} IN BOOLEAN MODE)
   ```

3. **Redis 缓存**: 缓存热门搜索关键词的结果

### 何时考虑 Elasticsearch

只有在以下情况下才建议引入 ES：

- 项目需要展示搜索引擎相关技术
- 教师明确要求使用 ES
- 项目规模扩大到 10,000+ 商品
- 需要高级搜索功能（拼音搜索、同义词等）
- 作为技术亮点展示（但需要完整实现，不能只引入依赖）

## 决策建议

| 场景 | 推荐方案 |
|------|---------|
| 课程实训提交 | MySQL（方案 A） |
| 技术展示需要 | Elasticsearch（方案 B） |
| 求职项目展示 | Elasticsearch（方案 B） |
| 快速开发迭代 | MySQL（方案 A） |

## 相关规范

- admin-product-management
- api-documentation
- docker-dev-environment

## 风险评估

**方案 A 风险**: 低
- 无代码变更风险
- 需要移除 ES 依赖以减少误导

**方案 B 风险**: 中
- 需要实现 ES 集成代码
- 需要维护数据同步逻辑
- 增加 Docker 部署复杂度
